(this.webpackJsonpguestb=this.webpackJsonpguestb||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(7),r=a.n(i),o=(a(13),a(2)),l=a(3),c=a(4),u=a(5),d=(a(14),a(1)),m=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).state={validUsername:void 0,validPassword:void 0,tempUsername:""},s.handlePasswordInput=s.handlePasswordInput.bind(Object(d.a)(s)),s.handleUsernameInput=s.handleUsernameInput.bind(Object(d.a)(s)),s.loginRequestSender=s.loginRequestSender.bind(Object(d.a)(s)),s.loginResponseHandler=s.loginResponseHandler.bind(Object(d.a)(s)),s}return Object(l.a)(a,[{key:"handleUsernameInput",value:function(e){this.setState({validUsername:/^[a-zA-Z0-9]{5,30}$/.test(e.target.value)})}},{key:"handlePasswordInput",value:function(e){this.setState({validPassword:/^.{7,200}$/.test(e.target.value)})}},{key:"loginRequestSender",value:function(){document.querySelector("#login-button").classList.add("loading"),this.state.tempUsername=document.querySelector("#loginName").value,api("POST","/user/login",this.loginResponseHandler,{username:this.state.tempUsername,password:document.querySelector("#loginPassword").value})}},{key:"loginResponseHandler",value:function(e){if(200===e.target.status){var t=JSON.parse(e.target.response);document.cookie="guestname="+this.state.tempUsername,document.cookie="sessionid="+t.token,document.location.reload()}else 401===e.target.status&&alert("Incorrect username or password");document.querySelector("#login-button").classList.remove("loading")}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"AuthenticationForm"},n.a.createElement("h4",null,"Login to continue"),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{id:"loginName",className:!1!==this.state.validUsername?"":"badInput",onChange:this.handleUsernameInput,type:"text",placeholder:"Username",formNoValidate:!0}),!1!==this.state.validUsername?"":n.a.createElement("span",{className:"warning"}," Invalid username ")),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{id:"loginPassword",className:!1!==this.state.validPassword?"":"badInput",onChange:this.handlePasswordInput,type:"password",placeholder:"Password",formNoValidate:!0}),!1!==this.state.validPassword?"":n.a.createElement("span",{className:"warning"}," Your password is too short ")),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{onClick:this.loginRequestSender,id:"login-button",type:"button",value:"Login",disabled:!this.state.validUsername||!this.state.validPassword}))))}}]),a}(n.a.Component),p=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).state={validUsername:void 0,validPassword:void 0,passwordsMatch:void 0,tempUsername:""},s.handleInput=s.handleInput.bind(Object(d.a)(s)),s.signupRequestSender=s.signupRequestSender.bind(Object(d.a)(s)),s.signupResponseHandler=s.signupResponseHandler.bind(Object(d.a)(s)),s}return Object(l.a)(a,[{key:"handleInput",value:function(){this.setState({validUsername:/^[a-zA-Z0-9]{5,30}$/.test(document.querySelector("#loginName").value)}),this.setState({validPassword:/^.{7,200}$/.test(document.querySelector("#loginPassword").value)}),this.setState({passwordsMatch:document.querySelector("#confirmPassword").value===document.querySelector("#loginPassword").value})}},{key:"signupRequestSender",value:function(){document.querySelector("#signup-button").classList.add("loading"),this.state.tempUsername=document.querySelector("#loginName").value,api("POST","/user/signup",this.signupResponseHandler,{username:this.state.tempUsername,password:document.querySelector("#loginPassword").value})}},{key:"signupResponseHandler",value:function(e){if(200===e.target.status){var t=JSON.parse(e.target.response);document.cookie="guestname="+this.state.tempUsername,document.cookie="sessionid="+t.token,document.location.reload()}else 451===e.target.status&&alert("Username is not available");document.querySelector("#signup-button").classList.remove("loading")}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("form",{className:"AuthenticationForm"},n.a.createElement("h4",null,"Register for free"),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{id:"loginName",className:!1!==this.state.validUsername?"":"badInput",onChange:this.handleInput,type:"text",placeholder:"Username",formNoValidate:!0}),!1!==this.state.validUsername?"":n.a.createElement("span",{className:"warning"}," Invalid username ")),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{id:"loginPassword",className:!1!==this.state.validPassword?"":"badInput",onChange:this.handleInput,type:"password",placeholder:"Password",formNoValidate:!0}),!1!==this.state.validPassword?"":n.a.createElement("span",{className:"warning"}," Your password is too short ")),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{onChange:this.handleInput,className:!1!==this.state.passwordsMatch?"":"badInput",id:"confirmPassword",type:"password",placeholder:"Confirm Password",formNoValidate:!0}),!1!==this.state.passwordsMatch?"":n.a.createElement("span",{className:"warning"}," Passwords doesn't match! ")),n.a.createElement("div",{className:"hiddenWrapper"},n.a.createElement("input",{id:"signup-button",onClick:this.signupRequestSender,type:"button",value:"Sign up",disabled:!this.state.validUsername||!this.state.validPassword||!this.state.passwordsMatch}))))}}]),a}(n.a.Component),h=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).state={userAlreadyRegistered:!1},s.userWantsToLogin=s.userWantsToLogin.bind(Object(d.a)(s)),s.userWantsToRegister=s.userWantsToRegister.bind(Object(d.a)(s)),s}return Object(l.a)(a,[{key:"userWantsToLogin",value:function(){this.setState({userAlreadyRegistered:!0})}},{key:"userWantsToRegister",value:function(){this.setState({userAlreadyRegistered:!1})}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("header",{className:"App-header"},n.a.createElement("h3",null,"Welcome to the guestbook"),this.state.userAlreadyRegistered?n.a.createElement("div",null,n.a.createElement(m,null),n.a.createElement("p",null,"Don't have an account?"," ",n.a.createElement("span",{className:"clickable",onClick:this.userWantsToRegister},"Rigister")," ","instead!")):n.a.createElement("div",null,n.a.createElement(p,null),n.a.createElement("p",null,"Have an account already?"," ",n.a.createElement("span",{className:"clickable",onClick:this.userWantsToLogin},"Login")," ","instead!"))))}}]),a}(n.a.Component),g=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement("ul",{className:"notificationPanel",hidden:!this.props.isOpen},this.props.notifications.map((function(t){return n.a.createElement("li",{"data-msg":t._id,"data-user":t.sender,"data-time":t.time,"data-status":t.status,onClick:function(){e.props.clickCallback({username:t.senderName,_id:t.sender})}},n.a.createElement("b",null,t.senderName,": "),t.content.substring(0,10),t.content.length>10?"...":"")})))}}]),a}(n.a.Component),v=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"chatBox",hidden:void 0===this.props.messages||!1===this.props.messages},n.a.createElement("div",{className:"chatStatus"},n.a.createElement("h3",null,this.props.user.username?this.props.user.username:"Choose a guest to message",this.props.user.username?n.a.createElement("span",{className:"navRight clickable",onClick:this.closeChat},"X"):"")),n.a.createElement("ul",null,void 0===this.props.messages?n.a.createElement("div",null,n.a.createElement("li",null,"No contact selected!"),n.a.createElement("li",null,"Welcome to the guestbook app")):!1===this.props.messages?n.a.createElement("div",null,n.a.createElement("li",null,"Hang on! the chat is loading...")):this.props.messages.length?this.props.messages.map((function(t){return n.a.createElement("li",{id:t._id,"data-time":t.time,"data-status":t.status,className:t.sender===e.props.user._id?"":"sentMessage"},t.content,t.sender===e.props.user._id?"":n.a.createElement("p",{className:"msgfooter"},n.a.createElement("span",{className:"clickable",onClick:function(){e.props.onMessageEdit(t._id,t.content)}}," ","\ud83d\udd8a"," "),n.a.createElement("span",{className:"clickable",onClick:function(){e.props.onMessageDelete(t._id)}}," ","\ud83d\uddd1"," ")))})):n.a.createElement("div",null,n.a.createElement("p",null,"Nothing here",n.a.createElement("br",null)," Try sending a message"))),n.a.createElement("form",{onSubmit:function(t){return e.props.onMessageSubmit(t)},className:"messagingForm"},n.a.createElement("input",{id:"messageInputBox",placeholder:"Write a message",type:"text"}),n.a.createElement("input",{type:"submit",value:"Send"})))}}]),a}(n.a.Component),f=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement("ol",{className:"guests",hidden:!this.props.isOpen},n.a.createElement("li",null,n.a.createElement("h2",null,"Guests")),this.props.users.map((function(t){return n.a.createElement("li",{"data-time":t.registered,"data-id":t._id,onClick:function(){e.props.clickCallback(t)}},t.username)})))}}]),a}(n.a.Component),b=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var s;Object(o.a)(this,a),s=t.call(this,e);var n=Math.floor(window.innerWidth/300),i=n>1;return s.state={lastStatusUpdate:0,deviceWidth:n,guestsListOpen:!0,notificationsPannelOpen:i,selectedContact:{},guests:[],chat:void 0,unread:[]},s.requestUpdates=s.requestUpdates.bind(Object(d.a)(s)),s.handleUpdates=s.handleUpdates.bind(Object(d.a)(s)),s.selectUser=s.selectUser.bind(Object(d.a)(s)),s.renderMessagesApiResponse=s.renderMessagesApiResponse.bind(Object(d.a)(s)),s.handleMessageSendingApiResponse=s.handleMessageSendingApiResponse.bind(Object(d.a)(s)),s.toggleNotificationsPannel=s.toggleNotificationsPannel.bind(Object(d.a)(s)),s.requestMessageDelete=s.requestMessageDelete.bind(Object(d.a)(s)),s.handleMessageDeletion=s.handleMessageDeletion.bind(Object(d.a)(s)),s.requestEditingMessage=s.requestEditingMessage.bind(Object(d.a)(s)),s.handleEditingMessage=s.handleEditingMessage.bind(Object(d.a)(s)),s.closeChat=s.closeChat.bind(Object(d.a)(s)),s.sendMessage=s.sendMessage.bind(Object(d.a)(s)),s}return Object(l.a)(a,[{key:"toggleNotificationsPannel",value:function(){this.setState({notificationsPannelOpen:!this.state.notificationsPannelOpen})}},{key:"componentDidMount",value:function(){this.requestUpdates(),this.updateInterval=setInterval(this.requestUpdates,5e3)}},{key:"requestUpdates",value:function(){console.log("Requesting status updates from the server");var e="/notification?index="+this.state.lastStatusUpdate;api("GET",e,this.handleUpdates)}},{key:"handleUpdates",value:function(e){var t=this;switch(console.log("Server responce arrived"),e.target.status){case 200:var a=JSON.parse(e.target.response);if(a.messages){beep.play(),console.log(a.messages.length+" new messages has arrived");var s=this.state;a.messages.forEach((function(e){s.unread.push(e),s.selectedContact&&e.sender===s.selectedContact._id&&t.selectUser(s.selectedContact)}))}if(a.users&&(console.log(a.users.length+" new users are registered"),a.users.forEach((function(e){s.guests.push(e)}))),a.users){var n=a.users[a.users.length-1].registered;n>s.lastStatusUpdate&&(s.lastStatusUpdate=n)}if(a.messages){var i=a.messages[a.messages.length-1].time;i>s.lastStatusUpdate&&(s.lastStatusUpdate=i)}this.setState(s);break;case 204:console.log("Status updates successfully delivered from the server! No new messages.");break;case 401:console.log("Server responded with 401! Looks like your login session has expired.");break;default:console.log("Unable to get status updates from the server!"),console.log(e)}}},{key:"renderMessagesApiResponse",value:function(e){switch(console.log("Server response arrived"),e.target.status){case 200:console.log("Messages fetched successfully");var t=JSON.parse(e.target.response);console.log(t),"object"!==typeof this.state.chat&&this.setState({chat:[]});var a=this.state;t.forEach((function(e){a.chat.push(e)}));var s=a.selectedContact._id;a.unread=a.unread.filter((function(e){return e.sender!==s})),this.setState(a);break;case 204:console.log("No Messages"),!1===this.state.chat&&this.setState({chat:[]});break;default:console.log("Something went wrong")}}},{key:"selectUser",value:function(e){this.setState({selectedContact:e,chat:!1}),api("GET","/messages/"+e._id,this.renderMessagesApiResponse),this.state.deviceWidth<2&&this.setState({notificationsPannelOpen:!1,guestsListOpen:!1})}},{key:"handleMessageSendingApiResponse",value:function(e){var t=document.querySelector("#messageInputBox");switch(t.classList.remove("loading"),e.target.status){case 200:console.log("Message delivered successfully!");var a=JSON.parse(e.target.response);console.log(a);var s=this.state.chat;s.push(a),this.setState({chat:s}),t.value="";break;default:console.log("Failed to send message")}}},{key:"sendMessage",value:function(e){e.preventDefault();var t=document.querySelector("#messageInputBox");api("POST","/message/"+this.state.selectedContact._id,this.handleMessageSendingApiResponse,{content:t.value}),t.classList.add("loading")}},{key:"handleMessageDeletion",value:function(e,t){switch(document.getElementById(t).classList.remove("loading"),e.target.status){case 204:this.setState({chat:this.state.chat.filter((function(e){return e._id!==t}))});break;default:alert("Failed to delete message!")}}},{key:"handleEditingMessage",value:function(e,t,a){switch(document.getElementById(t).classList.remove("loading"),e.target.status){case 204:for(var s=this.state.chat,n=0;n<s.length;n++)s[n]._id===t&&(s[n].content=a);this.setState({chat:s});break;default:alert("Failed to edit message!")}}},{key:"requestEditingMessage",value:function(e,t){var a=prompt("Edit message",t);if(a&&a.length){document.getElementById(e).classList.add("loading");var s=this.handleEditingMessage;api("PATCH","/message/"+e,(function(t){s(t,e,a)}),{content:a})}}},{key:"requestMessageDelete",value:function(e){if(window.confirm("Are you sure you want to delete this message?")){document.getElementById(e).classList.add("loading");var t=this.handleMessageDeletion;api("DELETE","/message/"+e,(function(a){t(a,e)}))}}},{key:"closeChat",value:function(){this.setState({selectedContact:{},chat:!1,guestsListOpen:!0})}},{key:"logout",value:function(){window.confirm("Are you sure you want to log out?")&&(document.cookie="guestname=; expires=Thu, 01-Jan-1970 00:00:01 GMT;",document.cookie="sessionid=; expires=Thu, 01-Jan-1970 00:00:01 GMT;",window.location.reload())}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"navBar"},n.a.createElement("h2",null,n.a.createElement("span",{className:"navLeft"},"Welcome to The GuestBook ",this.props.login,"!"),n.a.createElement("span",{onClick:this.logout,className:"navRight clickable"}," \u2bab"),n.a.createElement("span",{onClick:this.toggleNotificationsPannel,className:"navRight clickable"}," ","\u2709 ",this.state.unread.length," "))),n.a.createElement("div",{className:"mainPageContainer"},n.a.createElement(f,{isOpen:this.state.guestsListOpen,users:this.state.guests,clickCallback:this.selectUser}),n.a.createElement(v,{messages:this.state.chat,user:this.state.selectedContact,onMessageEdit:this.requestEditingMessage,onMessageDelete:this.requestMessageDelete,onMessageSubmit:this.sendMessage}),n.a.createElement(g,{isOpen:this.state.notificationsPannelOpen,notifications:this.state.unread,clickCallback:this.selectUser})))}}]),a}(n.a.Component),E=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var s;return Object(o.a)(this,a),s=t.call(this,e),-1===document.cookie.indexOf("guestname")?s.state={login:!1}:s.state={login:document.cookie.split("guestname=",2)[1].split(";",2)[0]},s}return Object(l.a)(a,[{key:"render",value:function(){var e,t=this.state.login;return e=t?n.a.createElement(b,{login:t}):n.a.createElement(h,null),n.a.createElement("div",{className:"App"},e)}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,a){e.exports=a(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.b5bad113.chunk.js.map